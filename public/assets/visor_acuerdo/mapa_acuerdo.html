<!DOCTYPE html>
<html lang="es">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>  
<title>Mapa del acuerdo</title>
 <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
 <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
 <link rel="stylesheet" href="./css/map_styles.css"/>
 <script type="text/javascript" src="https://www.google.com/jsapi?key="></script>
<script src="http://maps.google.com/maps/api/js?v=3&sensor=false"></script>
<script src="./js/Google.js"></script>
<script type="text/javascript" src="./js/jquery.min.js"></script>


<script type="text/javascript" charset="utf-8" src="./capas/municipios.js"></script>
<script type="text/javascript" charset="utf-8" src="./capas/veredas.js"></script>
<script type="text/javascript" charset="utf-8" src="./capas/veredas_point.js"></script>
</head>
<body>	
	<div id="map"></div>

	<script src="./highcharts/js/highcharts.js"></script>
	<script src="http://code.highcharts.com/modules/drilldown.js"></script>
	<script src="./highcharts/js/modules/exporting.js"></script>
	<script src="./highcharts/js/modules/export_csv.js"></script>
	<script type="text/javascript" charset="utf-8" src="./capas/colombia_line_mm.js"></script>

	<script type="text/javascript">	

		//POSICIÓN INICIAL DEL MAPA
		bounds = new L.LatLngBounds(new L.LatLng(-7, -90), new L.LatLng(15, -50));
		var map = new L.Map('map', {center: [4,-80], zoom: 6, maxBounds: bounds, zoomControl: false, attributionControl: false});

		var googleLayer_satellite = new L.Google("SATELLITE");
				
		//MAPAS BASE
		var topoMap_1=L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a>', maxZoom: 15 , minZoom: 6
		}).addTo(map); 
		var topoMap_2 = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a>'});
		
		//CARGAR CAPAS
		var style_veredas = {"color": "#cc66ff", "weight": 1.5, "opacity": 0.9 };
		var vda = L.geoJson(veredas, {style: style_veredas}).addTo(map);
		var vda_points = L.geoJson(veredas_point,{onEachFeature: interaccion_veredas});
		var mpios_acuerdo = L.geoJson(mpios_ac, {style: estilo, onEachFeature: interaccion_mpios}).addTo(map);
		var style_colombia = {"color": "#202020", "weight": 1.5, "opacity": 0.9 };
		var colombia_js= L.geoJson(colombia, {style: style_colombia});		
		colombia_js.addTo(map)

		function getColor(d) {
		return d == "Campamento" ? '#ff9933' :
           d == "Campamento y ZV"  ? '#BD0026' :
           d == "Piloto"  ? 'red' :
           d == "Zona veredal"  ? '#3366ff' :
           d == "Áreas de desarrollo alternativo" ? '#cc66ff':
                      '#FFEDA0';
		}

		//LEYENDA PALETA DE COLORES
				
		var legend = L.control({position: 'bottomleft'});

		legend.onAdd = function (map) {

			var div = L.DomUtil.create('div', 'info legend'),
				ha = ["Campamento", "Campamento y ZV", "Piloto", "Zona veredal","Áreas de desarrollo alternativo"],
				labels = [],
				from, to;

			for (var i = 0; i < ha.length; i++) {
				from = ha[i];
				//to = ha[i + 1];

				labels.push(
					'<i style="background:' + getColor(from) + '"></i> ' +
					from);
			}

			div.innerHTML = "<normal_bold><b>Leyenda</b></normal_bold><br/><br/>" + labels.join('<br>');
			return div;
		};

		legend.addTo(map);

		//INCLUIR TEXTO GME 
			
		var contextBanner = L.control({position: 'topleft'});

		contextBanner.onAdd = function (map) {
			this._div = L.DomUtil.create('div', 'contexto'); // create a div with a class "contexto"
			this._div.id = "context_Banner";
			var html_banner=  "<table><tr><td><img src='./images/info.png' width='20' height='20' align='middle'></td><td><b>Munucipios del acuerdo</b></td>" ;
			this._div.innerHTML= html_banner;
			return this._div;
		};

		contextBanner.addTo(map);

		var context_gme= document.getElementById("context_Banner");
		context_gme.onmouseover=function(){context_gme.innerHTML="<b>Dos Tipos de áreas fueron definidas <br><br>1. Zonas veredales transitorias de normalización (ZVTN): </b><br><br>Cuyo objeto es garantizar precisamente que cesen el fuego y las hostilidades de manera definitiva y que las FARC dejen las armas en manos de la Organización de las Naciones Unidas”.<br><br>Estas zonas son veredas o fracciones de veredas. La vereda es la más pequeña subdivisión en la estructura administrativa territorial colombiana.<br><br>De las 33 mil veredas existentes en el territorio colombiano, se usarán como zonas veredales transitorias de normalización (ZVTN) un total de 23.<br><br><b>2. Campamentos:</b><br><br>Habrá 8 campamentos, cada uno de 200 metros x 200 metros, es decir 4 hectáreas."};
		context_gme.onmouseout=function(){context_gme.innerHTML="<table><tr><td><img src='./images/info.png' width='20' height='20' align='middle'></td><td><b>Munucipios del acuerdo</b></td>"};

		
		//función que define el estilo de la capa municipios
		function estilo(feature) {
		return {
        fillColor: getColor(feature.properties.acuerdo),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
		};
		}

		function borde(e) {
			var layers = e.target;

			layers.setStyle({
				weight: 3,
				color: 'cyan',
				dashArray: '3',
				fillOpacity: 0
			});

			if (!L.Browser.ie && !L.Browser.opera) {
				layers.bringToFront();
			}			
		}
		
		//función que redefine el borde después de pasar con el mouse
		function resetborde(e) {
			mpios_acuerdo.resetStyle(e.target);
			//info.update();
			//grafica.update();
			
		};

		function interaccion_mpios(feature, layer) {
			var popupText = '<hr>Departamento: ' + feature.properties.NOM_DPTO + '<br/>   Municipio: ' + feature.properties.NOM_MPIO + '<br> Tipo: ' + feature.properties.acuerdo +'<hr>';	
			//layer.bindPopup(popupText);
			layer.on({
				mouseover: borde,
				mouseout: resetborde,
				click: onClick,
			});			
			//layer.bindPopup("Hola");
		};

		
		function interaccion_veredas(feature, layer) {
			if (feature.properties.Tipo_Proy=="PC"){
				x="Poserradicación y Contención";
			} else if (feature.properties.Tipo_Proy=="FGB"){
				x="Familia Guardabosques";	
			} else if (feature.properties.Tipo_Proy=="PP"){
				x="Proyectos Productivos";	
			} else if (feature.properties.Tipo_Proy=="FGB y PP"){
				x="Familia Guardabosques y Proyectos Productivos";	
			} else if (feature.properties.Tipo_Proy=="FGB y PC"){
				x="Familia Guardabosques y Poserradicación y Contención";	
			} else if (feature.properties.Tipo_Proy=="PP y PC"){
				x="Proyectos Productivos y Poserradicación y Contención";	
			} else if (feature.properties.Tipo_Proy=="FGB, PPy PC"){
				x="Familia Guardabosques, Proyectos Productivos y Poserradicación y Contención";	
			}
			else {
				x=feature.properties.Tipo_Proy;
			}
			var popupText = '<hr>Departamento: ' + feature.properties.NOM_DPTO + '<br/>   Municipio: ' + feature.properties.NOM_MPIO + '<br> Vereda: ' + feature.properties.NOM_TERR + '<br> Estrategia: ' + x +'<hr>';
			layer.bindPopup(popupText);

			//layer.bindPopup(popupText);
			//layer.bindPopup("Hola");
		};

		//zoom to feature
		function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
		};

		function onClick(e){
			var layer = e.target;
			grafica.update(layer.feature.properties);
			grafica2.update(layer.feature.properties);
			map.fitBounds(e.target.getBounds());
		};
		

		var baseMaps = {
		"Mapa topográfico OSM1": topoMap_1,
		"Mapa topográfico OSM2": topoMap_2,
		//"Mapa UNODC": topoMap_4,
		"Mapa Satelital Google " : googleLayer_satellite	
		};
		var capas = {"Municipios acuerdo": mpios_acuerdo}; 
		L.control.layers(baseMaps,capas,{position: 'bottomleft', collapsed: true}).addTo(map);

		//CONTROL ZOOM
		
		new L.Control.Zoom({ position: 'bottomleft' }).addTo(map);

		map.on('zoomend', function() {
		    if (map.getZoom() <9){
		        if (map.hasLayer(vda_points)) {
		            map.removeLayer(vda_points);
		        } else {
		            console.log("no point layer active");
		        }
		    }
		    if (map.getZoom() >= 9){
		        if (map.hasLayer(vda_points)){
		            console.log("layer already added");
		        } else {
		            map.addLayer(vda_points);
		        }
		    }
		})

	</script>
	<script type="text/javascript" src="./js/grafica_da.js"></script>
	<script type="text/javascript" src="./js/grafica_ci.js"></script>	
</body>
</html>